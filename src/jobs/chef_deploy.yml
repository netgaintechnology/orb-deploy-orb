description: >
  chef cookbook deployment

executor: chef

steps:
  - checkout
  - run: mkdir -p ./cookbook/$(grep -oP "(?<=name ')[^' ]+" ./metadata.rb)
  - run: rsync -au ./* ./cookbook/$(grep -oP "(?<=name ')[^' ]+" ./metadata.rb)
  - run: knife supermarket share $(grep -oP "(?<=name ')[^' ]+" ./metadata.rb) -o ./cookbook -u chef-supermarket -k ../.chef/chef-supermarket.pem
